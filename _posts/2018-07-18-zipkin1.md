layout : post
title : "APM框架zipkin简单介绍"
category : APM
tags : 调用链 分布式 zipkin

* content
{:toc}
　　APM（Application Performance Management & Monitoring），应用性能管理监控，主要作用是实时监控系统性能，并定位具体问题。zipkin是Twitter基于Google的Dapper实现的一款APM系统，主要监控分布式调用链，记录调用延时。



### 架构


　　zipkin的架构比较简单，如下图所示：

![zipkin架构图](https://github.com/shiliewrain/shiliewrain.github.io/blob/master/img/zipkin1.png?raw=true)

- 　　collector：收集Span

  

- 　　storage：存储Span

  

- 　　API：查询调用链

  

- 　　UI：提供展示页面

　　这里的Span是zipkin记录数据的基本单元，通常代表调用链中的一次请求。其数据结构如下图所示：

![span结构图](https://github.com/shiliewrain/shiliewrain.github.io/blob/master/img/zipkin2.png?raw=true)

　　一个完整的调用链包含至少一个Span，而这个调用链上的所有Span拥有相同且唯一的traceId。而每个Span都有各自不同的id，并且大部分Span还有parentId，这个parentId用于标识在此调用链中，自己的上一个Span的id，以便zipkin能将收集到Collector中的span组成调用链，如下所示：



![zipkin调用链](https://github.com/shiliewrain/shiliewrain.github.io/blob/master/img/zipkin3.png?raw=true)



### zipkin部署



　　根据[zipkin官方文档](https://zipkin.io/pages/quickstart.html)的介绍，启动方式有如下三种：



  1. docker启动：``` docker run -d -p 9411:9411 openzipkin/zipkin```

     

  2. Java启动：

     ```
     curl -sSL https://zipkin.io/quickstart.sh | bash -s
     java -jar zipkin.jar
     ```

  3. 源码启动：

     ```
     # get the latest source
     git clone https://github.com/openzipkin/zipkin
     cd zipkin
     # Build the server and also make its dependencies
     ./mvnw -DskipTests --also-make -pl zipkin-server clean install
     # Run the server
     java -jar ./zipkin-server/target/zipkin-server-*exec.jar
     ```

     

     